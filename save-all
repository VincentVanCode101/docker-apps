#!/usr/bin/env bash
set -euo pipefail

# collect all IMAGE_TAGs from configs
images=()
for cfg in "$HOME/projects/docker-apps"/*/config.sh; do
    source "$cfg"
    images+=("$IMAGE_TAG")
done

# name with date
out="$HOME/projects/docker-apps/docker-apps-$(date +%Y%m%d).tar"
echo "Saving ${#images[@]} images â†’ $out"
docker save "${images[@]}" -o "$out"

gzip -f "$out"
echo "-> ${out}.gz"
